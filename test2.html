<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Le AI Chat</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <style>
        :root {
    --primary-color: #4285F4;
    --secondary-color: #34A853;
    --background-color: #F1F3F4;
    --text-color: #202124;
    --sidebar-width: 250px;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Google Sans', Arial, sans-serif;
    display: flex;
    height: 100vh;
    background-color: var(--background-color);
    overflow: hidden;
}

/* Sidebar Styles */
.sidebar {
    width: var(--sidebar-width);
    background-color: white;
    border-right: 1px solid #E0E0E0;
    padding: 15px;
    display: flex;
    flex-direction: column;
    transition: all 0.3s ease;
    position: relative;
}

.sidebar-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 20px;
}

.sidebar-header img {
    width: 40px;
}

.toggle-sidebar {
    background: none;
    border: none;
    cursor: pointer;
    font-size: 20px;
    color: #666;
}

.new-chat-btn {
    width: 100%;
    padding: 10px;
    background-color: var(--primary-color);
    color: white;
    border: none;
    border-radius: 5px;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
}

.chat-history {
    flex-grow: 1;
    overflow-y: auto;
}

.chat-item {
    padding: 12px;
    margin-bottom: 10px;
    background-color: #F8F9FA;
    border-radius: 8px;
    cursor: pointer;
    transition: background-color 0.2s;
    display: flex;
    flex-direction: column;
}

.chat-item span {
    font-weight: bold;
}

.chat-item small {
    color: #666;
    font-size: 0.8em;
}

.chat-item:hover {
    background-color: #E9ECEF;
}

/* Chat Container Styles */
.chat-container {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    background-color: white;
    position: relative;
}

.chat-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 20px;
    background-color: #F8F9FA;
    border-bottom: 1px solid #E0E0E0;
}

.header-actions {
    display: flex;
    gap: 10px;
}

.share-btn, .context-btn {
    background-color: var(--secondary-color);
    color: white;
    border: none;
    padding: 8px 15px;
    border-radius: 20px;
    display: flex;
    align-items: center;
    gap: 5px;
}

.chat-messages {
    flex-grow: 1;
    overflow-y: auto;
    padding: 20px;
    background-color: white;
}

.welcome-message {
    text-align: center;
    color: #666;
    margin-top: 50px;
}

.message {
    max-width: 70%;
    margin-bottom: 15px;
    padding: 10px 15px;
    border-radius: 15px;
    clear: both;
}

.user-message {
    background-color: var(--primary-color);
    color: white;
    float: right;
    clear: both;
}

.ai-message {
    background-color: #F1F3F4;
    color: var(--text-color);
    float: left;
    clear: both;
}

.chat-input {
    display: flex;
    padding: 15px;
    background-color: #F8F9FA;
    border-top: 1px solid #E0E0E0;
}

#message-input {
    flex-grow: 1;
    padding: 10px;
    border: 1px solid #DAE1E9;
    border-radius: 20px;
    margin-right: 10px;
}

.send-btn {
    background-color: var(--primary-color);
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 20px;
    cursor: pointer;
}

/* Modal Styles */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0,0,0,0.4);
}

.modal-content {
    background-color: #fefefe;
    margin: 15% auto;
    padding: 20px;
    border: 1px solid #888;
    width: 80%;
    max-width: 500px;
    border-radius: 10px;
}

.close-modal {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
}

/* Responsive Design */
@media screen and (max-width: 768px) {
    .sidebar {
        position: fixed;
        left: -250px;
        z-index: 100;
        height: 100%;
    }

    .sidebar.active {
        left: 0;
    }

    .chat-container {
        width: 100%;
    }
}
/* Typing Indicator Styles */
.typing-indicator {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 10px;
}

.typing-dot {
    width: 8px;
    height: 8px;
    margin: 0 4px;
    background-color: #888;
    border-radius: 50%;
    animation: typing-bounce 1.4s infinite ease-in-out;
}

.typing-dot:nth-child(2) {
    animation-delay: 0.2s;
}

.typing-dot:nth-child(3) {
    animation-delay: 0.4s;
}

@keyframes typing-bounce {
    0%, 80%, 100% { 
        transform: translateY(0);
        opacity: 0.5;
    }
    40% { 
        transform: translateY(-6px);
        opacity: 1;
    }
}

/* Dark Mode Styles */
body.dark-mode {
    background-color: #121212;
    color: #E0E0E0;
}

body.dark-mode .sidebar {
    background-color: #1E1E1E;
    border-right-color: #333;
}

body.dark-mode .chat-container {
    background-color: #121212;
}

body.dark-mode .chat-header {
    background-color: #1E1E1E;
    border-bottom-color: #333;
}

body.dark-mode .chat-input {
    background-color: #1E1E1E;
    border-top-color: #333;
}

body.dark-mode .message.user-message {
    background-color: #2C5BB5;
}

body.dark-mode .message.ai-message {
    background-color: #2C2C2C;
    color: #E0E0E0;
}

body.dark-mode .chat-item {
    background-color: #2C2C2C;
    color: #E0E0E0;
}

body.dark-mode .chat-item:hover {
    background-color: #3C3C3C;
}
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2>Spark Chat</h2>
            <button class="toggle-sidebar" id="toggleSidebar">
                <i class="fas fa-chevron-left"></i>
            </button>
        </div>
        
        
        <button class="new-chat-btn" id="newChatBtn">
            <i class="fas fa-plus"></i> New Chat
        </button>

        <div class="chat-history" id="chatHistory">
            <div class="chat-item" data-chat-id="1">
                <span>üåç World Geography</span>
                <small>What are the largest countries?</small>
            </div>
            <div class="chat-item" data-chat-id="2">
                <span>üöÄ Space Exploration</span>
                <small>Tell me about Mars missions</small>
            </div>
            <div class="chat-item" data-chat-id="3">
                <span>üíª Programming</span>
                <small>Explain Python basics</small>
            </div>
        </div>
    </div>

    <!-- Chat Container -->
    <div class="chat-container" id="chatContainer">
        <div class="chat-header">
            <h3 id="chatTitle">Le Chat</h3>
            <div class="header-actions">
                <button  class="context-btn" id="theme-toggle">
                    <i class="fas fa-adjust"></i>
                </button>
                <!-- <button class="share-btn">
                    <i class="fas fa-share-alt"></i> Share
                </button> -->
                <button class="context-btn" id="contextBtn">
                    <i class="fas fa-link"></i> 
                </button>
            </div>
        </div>

        <div id="chat-messages" class="chat-messages">
            <!-- Messages will be dynamically added here -->
            <div class="welcome-message">
                <h2>Welcome to Le Chat AI</h2>
                <p>Select a chat or start a new conversation</p>
            </div>
        </div>

        <div class="chat-input">
            <input type="text" id="message-input" placeholder="Type your message...">
            <button class="send-btn" onclick="sendMessage()">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>

    <!-- Context Modal -->
    <div id="contextModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h3>Conversation Context</h3>
            <div id="contextDetails"></div>
        </div>
    </div>

    <script>
       const API_KEY  = 'AIzaSyDzCA-X2BzVlJo9A7n6lI8PXKCZtCBN1Oc'; // Replace with your actual API key
 
// DOM Elements
const sidebar = document.getElementById('sidebar');
const toggleSidebarBtn = document.getElementById('toggleSidebar');
const newChatBtn = document.getElementById('newChatBtn');
const chatHistory = document.getElementById('chatHistory');
const chatMessages = document.getElementById('chat-messages');
const messageInput = document.getElementById('message-input');
const chatTitle = document.getElementById('chatTitle');
const contextBtn = document.getElementById('contextBtn');
const contextModal = document.getElementById('contextModal');
const contextDetails = document.getElementById('contextDetails');

// Sample Chat Data
const predefinedChats = {
    1: [
        { type: 'ai', message: 'The largest countries by land area are:' },
        { type: 'ai', message: '1. Russia (17,098,242 km¬≤)' },
        { type: 'ai', message: '2. Canada (9,984,670 km¬≤)' },
        { type: 'ai', message: '3. China (9,596,961 km¬≤)' }
    ],
    2: [
        { type: 'ai', message: 'Mars Mission Overview:' },
        { type: 'ai', message: '- NASA\'s Perseverance Rover landed in 2021' },
        { type: 'ai', message: '- Goal: Search for signs of ancient microbial life' },
        { type: 'ai', message: '- Collected rock samples for future return to Earth' }
    ],
    3: [
        { type: 'ai', message: 'Python Basics:' },
        { type: 'ai', message: '- Interpreted, high-level programming language' },
        { type: 'ai', message: '- Supports multiple programming paradigms' },
        { type: 'ai', message: '- Example: print("Hello, World!")' }
    ]
};

// Sidebar Toggle
toggleSidebarBtn.addEventListener('click', () => {
    sidebar.classList.toggle('active');
});

// Chat History Item Click
chatHistory.addEventListener('click', (e) => {
    const chatItem = e.target.closest('.chat-item');
    if (chatItem) {
        const chatId = chatItem.dataset.chatId;
        loadPredefinedChat(chatId);
    }
});

// Load Predefined Chat
function loadPredefinedChat(chatId) {
    chatMessages.innerHTML = ''; // Clear existing messages
    chatTitle.textContent = chatHistory.querySelector(`[data-chat-id="${chatId}"] span`).textContent;

    predefinedChats[chatId].forEach(msg => {
        addMessage(msg.message, msg.type);
    });
}

// New Chat Button
newChatBtn.addEventListener('click', () => {
    chatMessages.innerHTML = `
        <div class="welcome-message">
            <h2>New Chat Started</h2>
            <p>Ask me anything!</p>
        </div>
    `;
    chatTitle.textContent = 'Le Chat';
});

// Context Button
contextBtn.addEventListener('click', () => {
    contextDetails.innerHTML = `
        <p>Current Chat Context:</p>
        <ul>
            <li>Topic: ${chatTitle.textContent}</li>
            <li>Total Messages: ${chatMessages.children.length}</li>
            <li>Last Interaction: Just now</li>
        </ul>
    `;
    contextModal.style.display = 'block';
});

// Close Modal
document.querySelector('.close-modal').addEventListener('click', () => {
    contextModal.style.display = 'none';
});

// Add Message Function
function addMessage(content, type) {
    const messageDiv = document.createElement('div');
    messageDiv.classList.add('message', `${type}-message`);
    messageDiv.textContent = content;
    chatMessages.appendChild(messageDiv);
    chatMessages.scrollTop = chatMessages.scrollHeight;
}

// Send Message Function
async function sendMessage() {
    const message = messageInput.value.trim();
    if (!message) return;

    // Add user message
    addMessage(message, 'user');
    messageInput.value = '';

    // Add loading indicator
    addMessage('Generating response...', 'ai');

    try {
        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                contents: [{ parts: [{ text: message }] }]
            })
        });

        const data = await response.json();
        const aiResponse = data?.candidates?.[0]?.content?.parts?.[0]?.text || 'Sorry, I could not generate a response.';

        // Remove loading indicator and add AI response
        chatMessages.removeChild(chatMessages.lastChild);
        addMessage(aiResponse, 'ai');

    } catch (error) {
        console.error('Error:', error);
        chatMessages.removeChild(chatMessages.lastChild);
        addMessage('Sorry, there was an error processing your request.', 'ai');
    }
}

// Enable sending message with Enter key
messageInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
        sendMessage();
    }
});

// Responsive Sidebar
window.addEventListener('resize', () => {
    if (window.innerWidth > 768) {
        sidebar.classList.remove('active');
    }
});
// Extended JavaScript with Advanced Features

// Theme Management
const themes = {
    light: {
        primaryColor: '#4285F4',
        secondaryColor: '#34A853',
        backgroundColor: '#F1F3F4',
        textColor: '#202124'
    },
    dark: {
        primaryColor: '#8AB4F8',
        secondaryColor: '#5FE084',
        backgroundColor: '#202124',
        textColor: '#E0E0E0'
    }
};

function applyTheme(themeName) {
    const theme = themes[themeName];
    document.documentElement.style.setProperty('--primary-color', theme.primaryColor);
    document.documentElement.style.setProperty('--secondary-color', theme.secondaryColor);
    document.documentElement.style.setProperty('--background-color', theme.backgroundColor);
    document.documentElement.style.setProperty('--text-color', theme.textColor);
    
    // Additional theme-specific adjustments
    document.body.classList.toggle('dark-mode', themeName === 'dark');
    localStorage.setItem('selectedTheme', themeName);
}

// Chat History Management
class ChatHistoryManager {
    constructor() {
        this.chats = JSON.parse(localStorage.getItem('chatHistory')) || [];
    }

    addChat(chat) {
        this.chats.push({
            id: Date.now(),
            title: chat.title,
            messages: chat.messages,
            timestamp: new Date().toISOString()
        });
        this.save();
    }

    getChatById(id) {
        return this.chats.find(chat => chat.id === id);
    }

    getAllChats() {
        return this.chats.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
    }

    save() {
        localStorage.setItem('chatHistory', JSON.stringify(this.chats));
    }

    clearHistory() {
        this.chats = [];
        this.save();
    }
}

// Advanced Context Tracking
class ContextTracker {
    constructor() {
        this.context = {
            topics: [],
            keyQuestions: [],
            conversationFlow: []
        };
    }

    addMessage(message, type) {
        this.context.conversationFlow.push({
            message,
            type,
            timestamp: new Date().toISOString()
        });

        // Extract potential topics and key questions
        if (type === 'user') {
            this.extractContextDetails(message);
        }
    }

    extractContextDetails(message) {
        // Simple context extraction (can be made more sophisticated)
        const keywords = message.toLowerCase().split(' ');
        const potentialTopics = keywords.filter(word => word.length > 3);
        
        if (potentialTopics.length > 0) {
            this.context.topics = [...new Set([...this.context.topics, ...potentialTopics])];
        }
    }

    getContext() {
        return {
            ...this.context,
            totalMessages: this.context.conversationFlow.length
        };
    }

    reset() {
        this.context = {
            topics: [],
            keyQuestions: [],
            conversationFlow: []
        };
    }
}

// Main Application Class
class GeminiChatApp {
    constructor() {
        // Initialize core components
        this.chatHistoryManager = new ChatHistoryManager();
        this.contextTracker = new ContextTracker();
        
        // DOM Elements
        this.initElements();
        
        // Event Listeners
        this.setupEventListeners();
        
        // Initialize theme
        this.initializeTheme();
    }

    initElements() {
        this.sidebarEl = document.getElementById('sidebar');
        this.chatMessagesEl = document.getElementById('chat-messages');
        this.messageInputEl = document.getElementById('message-input');
        this.chatTitleEl = document.getElementById('chatTitle');
        this.contextModalEl = document.getElementById('contextModal');
    }

    setupEventListeners() {
        // Theme switcher
        document.getElementById('theme-toggle').addEventListener('click', () => {
            const currentTheme = localStorage.getItem('selectedTheme') || 'light';
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            applyTheme(newTheme);
        });

        // Send message
        this.messageInputEl.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                this.sendMessage();
            }
        });

        // Context modal
        document.querySelector('.close-modal').addEventListener('click', () => {
            this.contextModalEl.style.display = 'none';
        });
    }

    initializeTheme() {
        const savedTheme = localStorage.getItem('selectedTheme') || 'light';
        applyTheme(savedTheme);
    }

    async sendMessage() {
        const message = this.messageInputEl.value.trim();
        if (!message) return;

        // Add user message
        this.addMessage(message, 'user');
        this.contextTracker.addMessage(message, 'user');
        this.messageInputEl.value = '';

        // Show typing indicator
        this.showTypingIndicator();

        try {
            const aiResponse = await this.generateAIResponse(message);
            
            // Remove typing indicator and add AI response
            this.hideTypingIndicator();
            this.addMessage(aiResponse, 'ai');
            this.contextTracker.addMessage(aiResponse, 'ai');

        } catch (error) {
            this.handleError(error);
        }
    }

    async generateAIResponse(message) {
        // Simulated AI response generation
        // Replace with actual Gemini API call
        return new Promise((resolve, reject) => {
            setTimeout(() => {
                const responses = [
                    "That's an interesting point. Could you tell me more?",
                    "I'm processing your query carefully.",
                    "Let me provide some insights on that.",
                    "Here's what I understand about your question."
                ];
                resolve(responses[Math.floor(Math.random() * responses.length)]);
            }, 1500);
        });
    }

    addMessage(content, type) {
        const messageDiv = document.createElement('div');
        messageDiv.classList.add('message', `${type}-message`);
        messageDiv.textContent = content;
        this.chatMessagesEl.appendChild(messageDiv);
        this.chatMessagesEl.scrollTop = this.chatMessagesEl.scrollHeight;
    }

    showTypingIndicator() {
        const typingIndicator = document.createElement('div');
        typingIndicator.classList.add('typing-indicator');
        typingIndicator.innerHTML = `
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
        `;
        this.chatMessagesEl.appendChild(typingIndicator);
    }

    hideTypingIndicator() {
        const typingIndicator = this.chatMessagesEl.querySelector('.typing-indicator');
        if (typingIndicator) {
            typingIndicator.remove();
        }
    }

    handleError(error) {
        console.error('Chat Error:', error);
        this.hideTypingIndicator();
        this.addMessage('Oops! Something went wrong. Please try again.', 'ai');
        
        // Optional: More detailed error tracking
        this.logErrorToConsole(error);
    }

    logErrorToConsole(error) {
        console.group('Chat Error Details');
        console.error('Message:', error.message);
        console.error('Stack:', error.stack);
        console.groupEnd();
    }
}

// Initialize the application
document.addEventListener('DOMContentLoaded', () => {
    window.chatApp = new GeminiChatApp();
});
function addMessage(content, type) {
    const messageDiv = document.createElement('div');
    messageDiv.classList.add('message', `${type}-message`);
    
    // Process code blocks
    const codeBlocks = content.split(/```([\s\S]*?)```/g);
    codeBlocks.forEach((part, index) => {
        if (index % 2 === 1) { // Code block content
            const codeContainer = document.createElement('div');
            codeContainer.className = 'code-container';
            
            const pre = document.createElement('pre');
            const code = document.createElement('code');
            code.textContent = part.trim();
            
            const copyBtn = document.createElement('button');
            copyBtn.className = 'copy-btn';
            copyBtn.innerHTML = '<i class="far fa-copy"></i> Copy';
            copyBtn.onclick = () => copyToClipboard(part.trim());
            
            codeContainer.appendChild(pre);
            codeContainer.appendChild(code);
            codeContainer.appendChild(copyBtn);
            messageDiv.appendChild(codeContainer);
        } else { // Regular text
            part.split(/\n\n+/).forEach(paragraph => {
                if (paragraph.trim()) {
                    const p = document.createElement('p');
                    p.innerHTML = paragraph.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                    messageDiv.appendChild(p);
                }
            });
        }
    });

    chatMessages.appendChild(messageDiv);
    chatMessages.scrollTop = chatMessages.scrollHeight;
}

    </script>
</body>
</html>